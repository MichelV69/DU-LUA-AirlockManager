{"slots":{"0":{"name":"insideSwitch","class":"PressureTile","type":{"events":[],"methods":[]}},"1":{"name":"insideDoor","class":"DetectionZone","type":{"events":[],"methods":[]}},"2":{"name":"outsideSwitch","class":"PressureTile","type":{"events":[],"methods":[]}},"3":{"name":"outsideDoor","class":"DetectionZone","type":{"events":[],"methods":[]}},"4":{"name":"insideLight","class":"Element","type":{"events":[],"methods":[]}},"5":{"name":"outsideLight","class":"Element","type":{"events":[],"methods":[]}},"6":{"name":"middleLight","class":"Element","type":{"events":[],"methods":[]}},"7":{"name":"insideSwitchLight","class":"Element","type":{"events":[],"methods":[]}},"8":{"name":"outsideSwitchLight","class":"Element","type":{"events":[],"methods":[]}},"10":{"name":"statusScreen1","class":"ScreenUnit","type":{"events":[],"methods":[]}},"-5":{"name":"library","type":{"events":[],"methods":[]}},"-4":{"name":"system","type":{"events":[],"methods":[]}},"-3":{"name":"player","type":{"events":[],"methods":[]}},"-2":{"name":"construct","type":{"events":[],"methods":[]}},"-1":{"name":"unit","type":{"events":[],"methods":[]}}},"handlers":[{"key":1,"filter":{"slotKey":-5,"signature":"onStart()","args":[]},"code":";(function()\nlocal a={}local b=0;function library.addEventHandlers(c)if not c or c.onEvent and c.triggerEvent then return false end;b=b+1;a[b]=c;local d,e,f='table','function','thread'if d~=type(c)then error('You can only add event handlers to table objects!')end;local g={}local function h(c)local i=type(c)return e==i or d==i and h(getmetatable(c).__call)or f==i end;c.onEvent=function(self,j,k,l)if not h(k)then error('Event handler must be a function, a callable object or a thread!')end;l=l or self;if d~=type(l)then error('The value of self must be a table!')end;if not g[j]then g[j]={_=0}end;local m=f==type(k)and function(...)coroutine.resume(k,...)end or k;local k=g[j]local n=k._+1;k[n]={m,l}k._=n;return n end;c.clearEvent=function(self,j,o)if g[j]and g[j][o]then g[j][o]=nil end end;c.clearAllEvents=function(self)g={}end;c.triggerEvent=function(self,j,...)local p=g[j]if p then for q=1,p._ do local k=p[q]if k then k[1](k[2],...)end end end end;return true end;function library.clearAllEventHandlers()for q=1,b do local c=a[q]if c and c.clearAllEvents then c:clearAllEvents()end end end\nend)()"},{"key":2,"filter":{"slotKey":-5,"signature":"onStart()","args":[]},"code":";(function()\nlocal a=DULibrary or{}function a.getLinks(b,c)local d={}if not b then b={}end;for e,f in pairs(unit.getOutPlugs())do local g=unit[f.name]if'table'==type(g)and'function'==type(g.getClass)then local h=true;for i,j in pairs(b)do if not('function'==type(g[i])and j==g[i]():sub(1,#j))then h=false;break end end;if h then if c then table.insert(d,g)else d[f.name]=g end end end end;return d end;function a.getLinksByClass(k,c)return a.getLinks({getClass=k},c)end;function a.getLinkByClass(k)return a.getLinksByClass(k,true)[1]end;function a.getCoreUnit()return a.getLinkByClass('CoreUnit')end;function a.getLinkByName(l)local m=a.getCoreUnit()if not m then error('getLinkByName requires a linked CoreUnit to work')end;local d=a.getLinks()for n,o in pairs(d)do if l==m.getElementNameById(o.getLocalId())then return o end end end\nend)()"},{"key":3,"filter":{"slotKey":-5,"signature":"onStart()","args":[]},"code":"package.preload['AirlockManager:globals.lua']=(function()\n-- Initialize globals and constants\nConfig = { unused = true }\nDEBUG = true\nINGAME = system ~= nil\n\nif not INGAME then\n\n    function traceback(o)\n        if o then P(tostring(o)) end\n    end\nelse\n    --require 'mockfuncs'\n    print=system.print\nend\nP=print\n\n--- end of file ---\n\nend)\npackage.preload['AirlockManager:common-library.lua']=(function()\n-- some global sample functions for strings\n-- use at your own risk :)\nfunction EndsWith(s, suffix)\n    if not s or not suffix then return false end\n    return string.sub(s, -#suffix) == suffix\nend\n\nfunction Rtrim(s)\n    local res, _ = string.gsub(s, \"%s+$\", \"\")\n    return res\nend\n\nfunction RtrimChar(s,char)\n    if not s or not char then return s end\n    while #s > 0 and EndsWith(s, char) do\n        s = string.sub(s,1,#s - #char)\n    end\n    return s\nend\n\nfunction DumpTable(o)\n   -- omitt any spaces in s!\n   if type(o) == 'table' then\n      local s = '{'\n      for k,v in pairs(o) do\n         if type(k) ~= 'number' then k = '\"'..k..'\"' end\n         s = s .. '['..k..']=' .. DumpTable(v) .. ','\n      end\n      s = RtrimChar(s,\",\")\n      return s .. '}'\n   else\n      return tostring(o)\n   end\nend\n\nend)\npackage.preload['AirlockManager:app-lib.lua']=(function()\nfunction statusLights(whichLights, whatAction)\n    if string.lower(whichLights) == 'all'\n        and string.lower(whatAction) == 'reset' then\n        insideLight.deactivate()\n        outsideLight.deactivate()\n        insideLight.setColor(ws2_blue)\n        outsideLight.setColor(ws2_blue)\n        insideLight.activate()\n        outsideLight.activate()\n    end\nend\n\nfunction closeAllDoors()\n    insideDoor.close()\n    outsideDoor.close()\nend\n\n--- end of file ---\n\nend)\npackage.preload['AirlockManager:app.lua']=(function()\nfunction app()\n    -- Here's to the crazy ones. The misfits. The rebels. The troublemakers.\n\n    -- -- when Switch is pressed, then start the Airlock cycle.\n    -- if BOTH Switches are active, reset and ignore\n\n    farSet         = {}\n    farSet.switch  = outsideSwitch\n    farSet.door    = outsideDoor\n    farSet.light   = outsideLight\n    farSet.buttonLight = outsideSwitchLight\n\n    nearSet        = {}\n    nearSet.switch = insideSwitch\n    nearSet.door   = insideDoor\n    nearSet.light  = insideLight\n\n    if outsideSwitch.active() then\n        farSet.switch  = insideSwitch\n        farSet.door    = insideDoor\n        farSet.light   = insideLight\n        nearSet.switch = outsideSwitch\n        nearSet.door   = outsideDoor\n        nearSet.light  = outsideLight\n    end\n    -- -- -- ensure far door closed\n    farSet.door.close()\n    -- -- -- open near door\n    nearSet.door.open()\n    -- -- -- set far door status light (red)\n    farSet.light.setColor(red)\n    -- -- -- set near door status light (green)\n    nearSet.light.setColor(green)\n    -- -- -- set far door Switch color (red)\n    -- -- -- set near door Switch color (blue)\n    -- -- -- update screens with process status\n    -- -- -- wait six seconds\n    -- -- -- close near door\n    -- -- -- set near door status light (red)\n    -- -- -- set near door Switch color (red)\n    -- -- -- update screens with process status\n    -- -- -- play airlock sound effect\n    -- -- -- wait three seconds\n    -- -- -- open far door\n    -- -- -- set far door status light (yellow)\n    -- -- -- update screens with process status\n    -- -- -- wait six seconds\n    -- -- -- close far door\n    -- -- -- set near door status light (green)\n    -- -- -- set near door Switch color (green)\n    -- -- -- set far door status light (green)\n    -- -- -- set far door Switch color (green)\n    -- -- -- update screens with process status\n    -- exit\nend\n\n--- end of file ---\n\nend)"},{"key":4,"filter":{"slotKey":-5,"signature":"onStart()","args":[]},"code":"library.addEventHandlers(library)\nlibrary.addEventHandlers(system)\nlibrary.addEventHandlers(player)\nlibrary.addEventHandlers(construct)\nlibrary.addEventHandlers(unit)\nlibrary.addEventHandlers(insideSwitch)\nlibrary.addEventHandlers(insideDoor)\nlibrary.addEventHandlers(outsideSwitch)\nlibrary.addEventHandlers(outsideDoor)\nlibrary.addEventHandlers(insideLight)\nlibrary.addEventHandlers(outsideLight)\nlibrary.addEventHandlers(middleLight)\nlibrary.addEventHandlers(insideSwitchLight)\nlibrary.addEventHandlers(outsideSwitchLight)\nlibrary.addEventHandlers(statusScreen1)"},{"key":5,"filter":{"slotKey":-4,"signature":"onActionStart(action)","args":[{"variable":"*"}]},"code":"system:triggerEvent('onActionStart',action)"},{"key":6,"filter":{"slotKey":-4,"signature":"onActionLoop(action)","args":[{"variable":"*"}]},"code":"system:triggerEvent('onActionLoop',action)"},{"key":7,"filter":{"slotKey":-4,"signature":"onActionStop(action)","args":[{"variable":"*"}]},"code":"system:triggerEvent('onActionStop',action)"},{"key":8,"filter":{"slotKey":-4,"signature":"onUpdate()","args":[]},"code":"system:triggerEvent('onUpdate')"},{"key":9,"filter":{"slotKey":-4,"signature":"onFlush()","args":[]},"code":"system:triggerEvent('onFlush')"},{"key":10,"filter":{"slotKey":-4,"signature":"onInputText(text)","args":[{"variable":"*"}]},"code":"system:triggerEvent('onInputText',text)"},{"key":11,"filter":{"slotKey":-4,"signature":"onCameraChanged(mode)","args":[{"variable":"*"}]},"code":"system:triggerEvent('onCameraChanged',mode)"},{"key":12,"filter":{"slotKey":-3,"signature":"onParentChanged(oldId,newId)","args":[{"variable":"*"},{"variable":"*"}]},"code":"player:triggerEvent('onParentChanged',oldId,newId)"},{"key":13,"filter":{"slotKey":-2,"signature":"onDocked(id)","args":[{"variable":"*"}]},"code":"construct:triggerEvent('onDocked',id)"},{"key":14,"filter":{"slotKey":-2,"signature":"onUndocked(id)","args":[{"variable":"*"}]},"code":"construct:triggerEvent('onUndocked',id)"},{"key":15,"filter":{"slotKey":-2,"signature":"onPlayerBoarded(id)","args":[{"variable":"*"}]},"code":"construct:triggerEvent('onPlayerBoarded',id)"},{"key":16,"filter":{"slotKey":-2,"signature":"onVRStationEntered(id)","args":[{"variable":"*"}]},"code":"construct:triggerEvent('onVRStationEntered',id)"},{"key":17,"filter":{"slotKey":-2,"signature":"onConstructDocked(id)","args":[{"variable":"*"}]},"code":"construct:triggerEvent('onConstructDocked',id)"},{"key":18,"filter":{"slotKey":-2,"signature":"onPvPTimer(active)","args":[{"variable":"*"}]},"code":"construct:triggerEvent('onPvPTimer',active)"},{"key":19,"filter":{"slotKey":-1,"signature":"onStop()","args":[]},"code":"unit:triggerEvent('onStop')"},{"key":20,"filter":{"slotKey":-1,"signature":"onTimer(timerId)","args":[{"variable":"*"}]},"code":"unit:triggerEvent('onTimer',timerId)"},{"key":21,"filter":{"slotKey":0,"signature":"onPressed()","args":[]},"code":"insideSwitch:triggerEvent('onPressed')"},{"key":22,"filter":{"slotKey":0,"signature":"onReleased()","args":[]},"code":"insideSwitch:triggerEvent('onReleased')"},{"key":23,"filter":{"slotKey":1,"signature":"onEnter(id)","args":[{"variable":"*"}]},"code":"insideDoor:triggerEvent('onEnter',id)"},{"key":24,"filter":{"slotKey":1,"signature":"onLeave(id)","args":[{"variable":"*"}]},"code":"insideDoor:triggerEvent('onLeave',id)"},{"key":25,"filter":{"slotKey":2,"signature":"onPressed()","args":[]},"code":"outsideSwitch:triggerEvent('onPressed')"},{"key":26,"filter":{"slotKey":2,"signature":"onReleased()","args":[]},"code":"outsideSwitch:triggerEvent('onReleased')"},{"key":27,"filter":{"slotKey":3,"signature":"onEnter(id)","args":[{"variable":"*"}]},"code":"outsideDoor:triggerEvent('onEnter',id)"},{"key":28,"filter":{"slotKey":3,"signature":"onLeave(id)","args":[{"variable":"*"}]},"code":"outsideDoor:triggerEvent('onLeave',id)"},{"key":29,"filter":{"slotKey":10,"signature":"onMouseDown(x,y)","args":[{"variable":"*"},{"variable":"*"}]},"code":"statusScreen1:triggerEvent('onMouseDown',x,y)"},{"key":30,"filter":{"slotKey":10,"signature":"onMouseUp(x,y)","args":[{"variable":"*"},{"variable":"*"}]},"code":"statusScreen1:triggerEvent('onMouseUp',x,y)"},{"key":31,"filter":{"slotKey":10,"signature":"onOutputChanged(output)","args":[{"variable":"*"}]},"code":"statusScreen1:triggerEvent('onOutputChanged',output)"},{"key":32,"filter":{"slotKey":-1,"signature":"onStart()","args":[]},"code":"\n\n-- DU-LuaC template with fixed slots by tobitege\n\n-- This script is drafted to have this project entry point load most\n-- required code parts via xpcall's for error handling.\n-- Generally speaking such parts can be:\n--  * globals -> as the name suggests ;)\n--  * startup -> not used in this entry point!\n--  * library -> any shared, independent objects and functions\n--  * events -> DU-LuaC assignment of code to specific element's events\n--  * main -> the actual main code of this project\n\n-- First some setup code to allow debugging in VSCode.\n-- These 2 lines do not interfere ingame but allow the use\n-- of debuggers running the script outside of the game.\n---@diagnostic disable: param-type-mismatch\npackage.path = \"./util/?.lua;\" .. package.path\npackage.path = package.path .. \";./util/du-mocks/?.lua\"\n\n-- File with commonly shared, independent global constants and switches etc.\n-- This is for use across multiple project entry points.\nrequire('AirlockManager:globals.lua')\n\n-- Sanity Check\nlocal bootErrors = 0\nif not outsideSwitch then bootErrors = bootErrors + 1 end\nif not insideSwitch then bootErrors = bootErrors + 1 end\n\nif not outsideDoor then bootErrors = bootErrors + 1 end\nif not insideDoor then bootErrors = bootErrors + 1 end\n\nif not outsideLight then bootErrors = bootErrors + 1 end\nif not insideLight then bootErrors = bootErrors + 1 end\n\nif bootErrors then\n    p(\" >> Boot Error.  Missing Crucial Equipment.\")\n    p(\" >> >> need 2 slots buttons, 2 slots doors, 2 slots lights\")\n    unit.exit()\nend\n\n-- The \"common-library\" could contain commonly shared functions\n-- for use across multiple project entries.\n-- Remove or replace as needed!\nlocal status, err, _ = xpcall(function() require('AirlockManager:common-library.lua') end, traceback)\nif not status then\n    P(\"[E] Error in common-library!\")\n    if err then P(err) end\n    unit.exit()\n    return\nend\n\n-- Event example: attach code to the screen's onOutputChanged event.\n-- This assumes the code in the file to return a table with a Run function\n-- and 1 parameter (here \"output\" is coming from the screen)!\n-- This ONLY works with the screen being a fixed slot in the project file\n-- as otherwise DU-LuaC won't be able to add its event handler code\n-- in the corresponding LUA section!\n\n--- local screenEvent = require('main-screen.onOutputChanged')\n--- if screenEvent ~= nil then\n---     -- important: event names start lowercase!\n---     MyScreen:onEvent('onOutputChanged', function (self, output) screenEvent.Run(output) end)\n--- end\n---\n--- -- Require the main script's code and in case of error, stop the board\n--- status, err, _ = xpcall(function() require('main-onStart') end, traceback)\n--- if not status then\n---     P(\"[E] Error in main-onStart!\")\n---     if err then P(err) end\n---     unit.exit()\n--- end\n\n-- Any additional code can be placed here\nP(\"Script pre-load finished.\")\nrequire('AirlockManager:app-lib.lua')\nrequire('AirlockManager:app.lua')\n\n-- Optionally hide the programming board widget\n--unit.hideWidget()\n\napp()\n\n--- end of file ---\n"}],"events":[],"methods":[]}